9月13日(土)
一旦
サブスクのキャンセル・契約
有料コンテンツの出しわけ
ログイン回りを完成させた。
次は、復習と微修正を繰り返して仕上げていこう。




2025/09/13
そもそもなんでstripe_customerが作成されてsupabaseのカラムにデータが入るのかを理解した方が早そうだ。






2025/09/10
現状できていないところ
stripe_customerカラムにデータがはいらない問題　←これ解決できたらサブスク契約ボタンが動く

仕組みとしは、supabaseのwebhookでAPPにサインインした段階で自動的にapi/create-stripe-customer
が叩かれてstripe顧客が作成されその作成された顧客のID？がsupabaseのstripe_customerにデータが入る仕組みにしている

試したこと

RLSをUPDATEとSELECTを全て  (auth.uid() = id)　から true　にして緩めたが変化なし





2025/08/30
・stripe顧客情報に挿入されない問題、stripeのログで解決しよう
・一旦のログインまわりと決済まわりを完成させる
time:20:05

現状、解決したこととして
１、vercelにstripeのシークレットキーや.envの中身を登録したことでデプロイのエラーが解消
２、本番環境でのテストを可能にした
３、supabaseのauthenticationのconfigでURLを本番環境に変更することで本番環境でのログインエラーを解消

課題
1、cookieの取り扱いでsupabase側のstripe_customerカラムにデータが入らない問題
localhost3000番を使用しPOSTMANでリクエストを送ってみたところstripe_customerに入れるデータは、作成できている様子


なんとなくだが
シンプルにTypeScriptで型安全に保ちつつNext.jsのページルーティングの恩恵を受けつつ
サーバーサイドとクライアントサイドをかき分けて
supabaseは、ローレベルセキュリティーRLSを意識しつつ今までのDBと同じような使い方で
使って、そのログとか吐いてくれる便利機能付きみたいな感じで、stripeのAPIとか叩くときは、
シークレットキーなど使って叩いてvercelとかにデプロイする時も一応.envがvercelのサーバー内にアップロード
されないからvercelに登録してあげることでstripeのAPIをvercelのサーバーから叩けるようになる的な話なんだろうなと
感じた。





2025/08/17
ngrokで一時的に外部サーバーへ公開したアプリで
ログインしかけたがAPIがうまく作動しなかった。
おそらくcookieありなしで受け付けるか判断してるが故っぽい
なので、一旦vercelにデプロイしてみて解決できるか試してみる。